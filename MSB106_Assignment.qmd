---
title: "MSB106 - Assignment"
author: "Sindre H. Øveraas, Alen Colakovic, Mona Lisa Jones & Sebastian M. Fløysand"
format:
 pdf:
  fontsize: "10"
  documentclass: article
  margin-left: 2cm
  margin-right: 2cm
papersize: A4
editor: visual
---

```{r, message=FALSE}
library(rgdal)
library(dplyr)
library(RSQLite)
library(sf)
library(tidyverse)
library(readr)
library(ggplot2)
library(kableExtra)
library(huxtable)
```

```{r, message=FALSE}
NOR_CBD <- read_csv("NOR_CBD.csv")
Dist_CBD_Dentist <- read_csv("Dist_CBD_Dentist.csv")
Zonal_CBD <- read_csv("Zonal_CBD.csv")
Dist_Mal_Dentist <- read.csv("Dist_Mal_Dentist.csv")
NOR_OSM_SHOP_MAL <- read.csv("NOR_OSM_SHOP_MAL.csv")
Zonal_Den <- read.csv("Zonal_Den.csv") |>
  select(fid, X_sum)
Dist_Comp_Den <- read.csv("Dist_Comp_Den.csv") |>
  select(fid, distance)
NOR_KOMM <- read_csv("NOR_KOMM.csv")
NOR_KOMM_2 <- read_csv("NOR_KOMM_2.csv")
```

```{r}
Commune_Data <- inner_join(NOR_KOMM, NOR_KOMM_2, by = "kommunenummer") |>
  select(kommunenummer, HubName, HubDist, Turnover_capita_retail_Omsetning) |>
  rename("knr" = kommunenummer, "DistMal" = HubDist, "HubNameMal" = HubName, "Turnover_capita_retail" = Turnover_capita_retail_Omsetning)
```

```{r}
Dentist_Data <- inner_join(Dist_Mal_Dentist, Dist_CBD_Dentist, by = "fid") |>
  select(fid, Juridisk.n, Antall.ans, Sum.Drifts, Sum.salgsi, Driftsresu.y, osm_id.y, latlong.y, HubName.y, HubDist.y, HubName.x, HubDist.x) |>
  rename("DistMal" = HubDist.x, "DistCBD" = HubDist.y, "HubNameMal" = HubName.x, "HubNameCBD" = HubName.y, "Driftsres" = Driftsresu.y, "osm_id" = osm_id.y, "latlong" = latlong.y)
```

```{r}
Dentist_Data <- inner_join(Dentist_Data, Zonal_Den, by = "fid")
```

```{r}
Dentist_Data <- inner_join(Dentist_Data, Dist_Comp_Den, by = "fid") |>
  rename("DistComp" = distance)
```

## Introduction

Our main task in this assignment is to perform an analysis of geospatial determinants of firm activity.
More specifically we are to focus on the Norwegian dental industry in this regard, and see how geospatial determinants such as distances to shopping malls and CBDs (Central Business Districts), as well as population density can determine dental businesses income and general financial operations.
As an example, central questions in this assignment will be; "Is it more beneficial to be highly centralized in urban areas with high population density and many competitors, or is it a greater advantage to be less centralized to the advantage that the nearest competing company is considerably further away?", "Which determinants appear to be most significant for economic benefit?"

## Theoretical Foundation of Hypothesis

## Data description

```{r}
kable(summary(Commune_Data))
```

```{r}
kable(summary(Dentist_Data[3:6]))
```

```{r}
kable(summary(Dentist_Data[8:11]))
```

```{r}
kable(summary(Dentist_Data[11:14]))
```

```{r}
Commune_Data |>
  ggplot(aes(x = DistMal, y = Turnover_capita_retail, colour = DistMal)) +
  geom_point(lwd = .9) +
  labs(x = "Distance from Mall", y = "Turnover capita in retail per inhabitant") +
  theme_bw()
```

Might be more appropriate to explore the distance from CBDs to Malls compared to turnover capita in retail per inhabitant, rather than the distance from the geographical centroid of Norwegian Communes, because of the tendency of bigger population density around CBDs.

```{r}
Dentist_Data |>
  ggplot(aes(x = DistCBD, y = Sum.salgsi, colour = DistCBD)) +
  geom_point(lwd = .9) +
  labs(x = "Distance from CBD", y = "Income") +
  theme_bw()
```

```{r}
Dentist_Data_LIMIT <- Dentist_Data |>
  filter(Sum.salgsi < 100000000, DistCBD < 250,
         Driftsres < 20000000, Driftsres > -10000000, DistMal < 80)
```

```{r}
Dentist_Data_LIMIT |>
  ggplot(aes(x = DistCBD, y = Sum.salgsi, colour = DistCBD)) +
  geom_point(lwd = .9) + labs(x = "Distance from CBD", y = "Income") +
  theme_bw()
```

```{r}
Dentist_Data |>
  ggplot(aes(x = DistMal, y = Driftsres, colour = DistMal)) +
  geom_point(lwd = .9) +
  labs(x = "Distance from Mall", y = "EBIT") +
  theme_bw()
```

```{r}
Dentist_Data_LIMIT |>
  ggplot(aes(x = DistMal, y = Driftsres, colour = DistMal)) +
  geom_point(lwd = .9) +
  labs(x = "Distance from Mall", y = "EBIT") +
  theme_bw()
```

```{r}
Dentist_Data_LIMIT |>
  ggplot(aes(x = X_sum, y = Sum.salgsi, colour = Sum.salgsi)) +
  geom_point(lwd = .9) +
  labs(x = "Pop density", y = "Income") +
  theme_bw()
```

```{r}
lm1 <- lm(Sum.salgsi ~ X_sum, data = Dentist_Data_LIMIT)
lm2 <- lm(Sum.salgsi ~ DistComp + DistCBD + DistMal + X_sum + (DistCBD*X_sum), data = Dentist_Data_LIMIT)
```

```{r}
huxreg(list("Model 1" = lm1, "Model 2" = lm2), statistics = c(N = "nobs", R2 = "r.squared"), const. = "(Intercept)", note = "Note: {stars} T statistics in brackets.")
```

## Econometric approach
